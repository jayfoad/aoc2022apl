⎕IO←0
to←{⍺+(×⍵-⍺)×⍳1+|⍵-⍺}
p←⍎¨¨'\d+'⎕S'&'¨⊃⎕NGET'p14.txt'1
q←⊃,/⊃,/2{⊃,¨/⍺ to¨⍵}/¨{⍵⊂⍨1 0⍴⍨≢⍵}¨p
r←1@q⊢1000 200⍴0
k←0 ¯1 1
f←{3::⍺ ⋄ ⍬≡⍵:⍺ ⋄ ∧/t←⍺⌷⍨k 1+w←2↑⍵:(1@(⊂w)⊢⍺)∇2↓⍵ ⋄ ⍺∇⍵,⍨w+1,⍨k⊃⍨t⍳0}
g←{+/,⍵<⍵ f 500 0}
g r ⍝ part 1
g 1@(2+⊃⌽⍸∨⌿r)⍤1⊢r ⍝ part 2
